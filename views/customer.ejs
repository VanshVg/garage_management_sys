<style>
    * {
        scroll-behavior: smooth;
    }

    ::placeholder {
        color: var(--bg-light);
        font-size: 14px;
        letter-spacing: 1px;
        text-align: center;
    }

    ::-webkit-scrollbar {
        width: 0px;
        height: 0px;
    }

    input[type=radio] {
        display: none;
    }

    input[name=garage]:checked+label>div {
        border: 1px solid white
    }

    input[type=checkbox]:checked+label>div {
        border: 1px solid white
    }
</style>
<%- include('./customer/head.ejs') %>
    <link rel="stylesheet" href="/styles/mapOverlay.css">
    <% var active=active || 'dashboard' ; %>
        <div id="container" class="flex h-screen overflow-hidden w-full">
            <%- include('./customer/headbar.ejs') %>
                <div class="w-[78%] h-screen">
                    <div class="h-screen w-full bg-lightbg relative">
                        <div class="overlay absolute w-full h-full bg-red flex justify-center items-center"
                            style="z-index: 99999;">
                            <div class="ring">
                            </div>
                        </div>
                        <%- include('./customer/dashboardMap.ejs')%>
                            <div class="absolute bottom-1 right-1" style="z-index: 99999999;" id="btn-container">
                                <button id="btn-prev" onclick="changePage('prev')"
                                    class="hidden cursor-pointer bg-dark p-2 rounded-md text-white text-bold tracking-wider px-6">
                                    <<< </button>
                                        <button id="btn-next"
                                            class="hidden cursor-pointer bg-dark p-2 rounded-md text-white text-bold tracking-wider px-6"
                                            onclick="changePage('next')">
                                            >>> </button>
                            </div>
                    </div>
                </div>
                <div class="h-screen w-[22%] bg-dark">
                    <div class="page-match-container" id="dashboard-container">
                        <strong class="text-white">Loading..</strong>
                    </div>
                    <div class="page-match-container" id="vehicle-container" style="display: none;">
                        <strong class="text-white">Loading..</strong>
                    </div>
                    <div class="page-match-container" id="service-container" style="display: none;">
                        <strong class="text-white">Loading..</strong>
                    </div>
                </div>
        </div>

        <script>
            const handleGarageChange = () => {
                localStorage.setItem('garageId', document.querySelector("input[name=garage]:checked").value)
            }
            let loadData = {
                dashboard: async () => {
                    let garages = await callAPI("/customer/garageList");
                    console.log(garages);
                    if (!garages.result.length) {
                        document.getElementById('btn-next').classList.add('hidden');
                        document.getElementById('dashboard-container').innerHTML = `
                        <div class="w-full h-full flex justify-center items-center flex-col">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="width:100px;height:100px;fill:#ef4444">
  <path d="M111.98 312.074c-20.571 0-37.307 16.736-37.307 37.307 0 20.57 16.736 37.305 37.307 37.305s37.306-16.735 37.306-37.305c.001-20.571-16.734-37.307-37.306-37.307zm0 59.586c-12.286 0-22.28-9.994-22.28-22.278 0-12.286 9.995-22.28 22.28-22.28s22.279 9.995 22.279 22.28c.001 12.284-9.994 22.278-22.279 22.278zM398.67 312.074c-20.571 0-37.306 16.736-37.306 37.307 0 20.57 16.735 37.305 37.306 37.305 20.571 0 37.306-16.735 37.306-37.305 0-20.571-16.735-37.307-37.306-37.307zm0 59.586c-12.285 0-22.279-9.994-22.279-22.278 0-12.286 9.995-22.28 22.279-22.28s22.279 9.995 22.279 22.28c0 12.284-9.994 22.278-22.279 22.278zM322.948 379.664H188.991c-4.15 0-7.514 3.363-7.514 7.514s3.363 7.514 7.514 7.514h133.958c4.15 0 7.514-3.363 7.514-7.514s-3.364-7.514-7.515-7.514zM322.948 351.65H188.991c-4.15 0-7.514 3.363-7.514 7.514s3.363 7.514 7.514 7.514h133.958c4.15 0 7.514-3.363 7.514-7.514s-3.364-7.514-7.515-7.514z"/><path d="M512 250.916c0-19.976-16.252-36.228-36.229-36.228-24.388 0-42.006 23.827-34.512 47.246l-16.197 10.187a166.008 166.008 0 0 0-13.56-60.142h35.206c27.54 0 44.248-28.659 29.44-50.402l-61.071-98.208a7.514 7.514 0 1 0-12.761 7.937c65.793 105.801 64.29 100.883 64.29 107.931 0 9.769-8.926 17.716-19.897 17.716H266.513c-14.595 0-24.224-13.509-18.031-25.229.453-.858-1.231 1.897 29.367-47.307l.003-.006L339.19 25.77c7.536-12.13 27.262-12.136 34.81.003l15.132 24.335a7.512 7.512 0 0 0 10.349 2.412 7.514 7.514 0 0 0 2.412-10.349l-15.132-24.334C380.545 7.841 368.985 1.63 356.594 1.63c-12.395 0-23.954 6.211-30.165 16.207l-58.993 94.867c-5.236-.239-6.66-.195-16.317-.195-89.035 0-161.84 70.762-165.162 158.997l-15.216-9.57a36.105 36.105 0 0 0 1.718-11.019c0-19.976-16.252-36.228-36.229-36.228S0 230.94 0 250.916c0 33.223 41.205 48.838 63.273 24.074l13.51 8.497c-18.661 7.78-32.19 25.457-34.013 46.438h-4.605c-12.969 0-23.521 10.552-23.521 23.521v26.68c0 12.97 10.552 23.522 23.521 23.522h4.381v6.953c-10.062 2.416-17.565 11.483-17.565 22.276 0 12.633 10.279 22.911 22.912 22.911h19.554v31.059c0 12.969 10.552 23.521 23.521 23.521h48.025c12.969 0 23.521-10.551 23.521-23.521v-4.016l36.949-27.043h112.068l36.948 27.043v4.016c0 12.969 10.552 23.521 23.521 23.521h48.025c12.969 0 23.521-10.551 23.521-23.521V455.79H463.1c12.634 0 22.912-10.279 22.912-22.911 0-10.792-7.503-19.86-17.565-22.276v-6.953h4.592c12.969 0 23.521-10.552 23.521-23.522v-26.679c0-12.969-10.552-23.521-23.521-23.521h-4.817c-1.804-20.756-15.063-38.278-33.413-46.184l13.915-8.752c22.11 24.807 63.276 9.095 63.276-24.076zM36.229 272.12c-11.691 0-21.202-9.511-21.202-21.203 0-11.69 9.511-21.201 21.202-21.201s21.202 9.511 21.202 21.201c.001 11.691-9.511 21.203-21.202 21.203zm373.912 7.114h-19.932c-.098-24.043-6.58-47.015-18.854-67.254h23.629c9.981 20.475 15.157 42.669 15.157 67.254zm-82.069 15.088-9.696 29.381H192.617l-9.695-29.381h145.15zm-61.561-82.342h86.863c14.18 19.684 21.704 42.847 21.817 67.254h-239.39c.277-57.629 43.589-106.202 99.358-114.464-11.644 22.16 6.094 47.21 31.352 47.21zm-15.393-84.444h7.094l-13.159 21.161c-69.055 3.627-123.984 60.514-124.274 130.537h-19.927c0-86.833 69.398-151.698 150.266-151.698zM38.165 388.624c-4.684 0-8.494-3.812-8.494-8.495v-26.68c0-4.684 3.811-8.494 8.494-8.494h4.381v43.671h-4.381v-.002zm109.323 98.226c0 4.683-3.811 8.494-8.494 8.494H90.969c-4.684 0-8.494-3.811-8.494-8.494v-31.059h65.013v31.059zm15.027-22.637v-8.421h11.506l-11.506 8.421zm174.458-8.422h11.505v8.42l-11.505-8.42zm91.547 31.059c0 4.683-3.811 8.494-8.494 8.494h-48.025c-4.684 0-8.494-3.811-8.494-8.494v-31.058h65.013v31.058zm53.016-133.402v26.68c0 4.684-3.811 8.495-8.494 8.495h-4.592v-43.671h4.592c4.683.002 8.494 3.812 8.494 8.496zm-28.115-18.675v75.196H98.604c-4.15 0-7.514 3.363-7.514 7.514s3.363 7.514 7.514 7.514h364.498c4.348 0 7.885 3.537 7.885 7.885s-3.537 7.884-7.885 7.884H47.893c-4.348 0-7.885-3.536-7.885-7.884 0-4.348 3.537-7.885 7.885-7.885h24.663c4.15 0 7.514-3.363 7.514-7.514s-3.363-7.514-7.514-7.514H57.573c0-13.991.212-13.83.212-13.83 0-63.072-.212-61.366-.212-61.366 0-22.337 18.174-40.511 40.51-40.511 4.922 0 64.092.06 69.014.06l12.952 39.25a7.513 7.513 0 0 0 7.135 5.158H323.81a7.515 7.515 0 0 0 7.135-5.158l12.952-39.25c.352 0 40.487.041 40.845-.06h27.739c23.415 0 40.94 18.679 40.94 40.511zm22.35-105.058c11.691 0 21.202 9.511 21.202 21.201 0 11.692-9.511 21.203-21.202 21.203-11.692 0-21.203-9.511-21.203-21.203-.001-11.69 9.511-21.201 21.203-21.201z"/><path d="M347.695 31.066 258.176 175.02c-2.322 3.735-.952 8.668 2.972 10.664 3.515 1.791-8.75 1.251 185.678 1.251 8.21-.078 11.197-7.073 8.194-11.905L365.493 31.063c-3.672-5.857-14.188-5.814-17.798.003zm-69.887 140.842 78.788-126.696 78.788 126.696H277.808z"/><path d="M361.523 145.668h-9.849a2.505 2.505 0 0 0-2.505 2.505v8.238a2.505 2.505 0 0 0 2.505 2.505h9.849a2.504 2.504 0 0 0 2.505-2.505v-8.238a2.506 2.506 0 0 0-2.505-2.505zM349.169 91.433v45.305a2.505 2.505 0 0 0 2.505 2.505h9.849a2.504 2.504 0 0 0 2.505-2.505V91.433a2.505 2.505 0 0 0-2.505-2.505h-9.849a2.504 2.504 0 0 0-2.505 2.505z"/></svg>
        <h2 class="text-[#ef4444] font-bold text-2xl">Oops..!!</h2><p class="text-[#ef4444]"><b> No garage found...!!!</b></p>
  </div>
                         `;
                        return
                    }
                    let garageList = `<div class="h-full w-full p-3">
                        <strong class="text-white text-left">Nearby Garages</strong>
                        <hr/>
                        <div class="h-[95%] w-full overflow-scroll">
                        `;
                    garages.result.forEach(garage => {
                        let address=(garage.area + ',' + garage.city_name + ',' + garage.state_name);
                        address = address.length>50 ? address.substring(0,50)+"..." : address
                        garageList += `
                        <input type='radio' id='garage-${garage.id}' name='garage' value='${garage.id}'/>
                        <label for="garage-${garage.id}" class="cursor-pointer">
                        <div class="relative bg-[rgba(0,0,0,.2)] p-2 max-w-fit h-[100px] mt-5 rounded-lg flex" style="box-shadow:1px 1px 1px rgba(0,0,0,.2),inset 1px 1px 1px rgba(255,255,255,.2)">
                      <div class="absolute top-0.5 right-0.5 bg-yellow-600 flex rounded-md px-1 justify-center items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" style="fill: rgba(255, 255, 255, 1); stroke:white; stroke-width: 1.7px;"><path d="M21.947 9.179a1.001 1.001 0 0 0-.868-.676l-5.701-.453-2.467-5.461a.998.998 0 0 0-1.822-.001L8.622 8.05l-5.701.453a1 1 0 0 0-.619 1.713l4.213 4.107-1.49 6.452a1 1 0 0 0 1.53 1.057L12 18.202l5.445 3.63a1.001 1.001 0 0 0 1.517-1.106l-1.829-6.4 4.536-4.082c.297-.268.406-.686.278-1.065z"></path></svg>
                        <span class="text-[12px] text-white text-semibold mx-0.5">5.0</span>
                        </div>
                            <div class="garage-icon border-2 w-2/4 rounded-md overflow-hidden">
                          <img src="/uploads/${garage.thumbnail}" onerror="this.src='https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSeUyb754vebKqfbxScXd11wIOQGyxRlNNQBv31JG4wC9ytLmJgMP3i__68EPQpIN3vrPk&usqp=CAU'" class="h-full w-full bg-cover rounded-md" alt="garage">
                      </div>
                      <div class="garage-info w-3/4 p-2">
                          <h3 class="font-medium text-[14px] text-left text-white wrap-none" id="garageName">${garage.garage_name.length > 15 ? garage.garage_name.substring(0, 12) + '..' : garage.garage_name}</h3>
                          <div class="flex pt-2">
                              <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" viewBox="0 0 24 24" style="fill:rgba(255,255,255,.6);"><path d="M11.42 21.815a1.004 1.004 0 0 0 1.16 0C12.884 21.598 20.029 16.44 20 10c0-4.411-3.589-8-8-8S4 5.589 4 9.996c-.029 6.444 7.116 11.602 7.42 11.819zM12 4c3.309 0 6 2.691 6 6.004.021 4.438-4.388 8.423-6 9.731-1.611-1.308-6.021-5.293-6-9.735 0-3.309 2.691-6 6-6z"></path><path d="M11 14h2v-3h3V9h-3V6h-2v3H8v2h3z"></path></svg>
                              <p class="pl-2 text-xs break-all text-[rgba(255,255,255,.6)] ">${address}</p>
                          </div>
                          
                      </div>
                  </div></label>
                  `

                    });
                    garageList += '</div></div>'
                    document.getElementById('dashboard-container').innerHTML = garageList;
                    document.querySelector('input[name=garage]').setAttribute('checked', true);
                    handleGarageChange();
                    document.querySelectorAll('input[name=garage]').forEach(garageBox => {
                        garageBox.addEventListener('change', handleGarageChange);
                    })
                },
                service: async () => {
                    let garageId = localStorage.getItem('garageId');
                    let services = await callAPI(`/customer/servicesList/${garageId}`);
                    let serviceList = `
                    <div class="h-full w-full p-3">
                        <strong class="text-white text-left">Services</strong>
                        <hr/>
                        <div class="h-[95%] w-full overflow-scroll">
                    `;
                    if (!services.length) {
                        serviceList = `
                        <div class="w-full h-[80vh] flex justify-center items-center flex-col">
        <svg class="fill-[#ef4444]" width="100px" height="100px" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M520.741 163.801a10.234 10.234 0 00-3.406-3.406c-4.827-2.946-11.129-1.421-14.075 3.406L80.258 856.874a10.236 10.236 0 00-1.499 5.335c0 5.655 4.585 10.24 10.24 10.24h846.004c1.882 0 3.728-.519 5.335-1.499 4.827-2.946 6.352-9.248 3.406-14.075L520.742 163.802zm43.703-26.674L987.446 830.2c17.678 28.964 8.528 66.774-20.436 84.452a61.445 61.445 0 01-32.008 8.996H88.998c-33.932 0-61.44-27.508-61.44-61.44a61.445 61.445 0 018.996-32.008l423.002-693.073c17.678-28.964 55.488-38.113 84.452-20.436a61.438 61.438 0 0120.436 20.436zM512 778.24c22.622 0 40.96-18.338 40.96-40.96s-18.338-40.96-40.96-40.96-40.96 18.338-40.96 40.96 18.338 40.96 40.96 40.96zm0-440.32c-22.622 0-40.96 18.338-40.96 40.96v225.28c0 22.622 18.338 40.96 40.96 40.96s40.96-18.338 40.96-40.96V378.88c0-22.622-18.338-40.96-40.96-40.96z"/></svg>
        <h2 class="text-[#ef4444] font-bold text-2xl">Oops..!!</h2><p class="text-[#ef4444]"><b> No Service available...!!!</b></p>
  </div>
                        `
                    }
                    else {


                        services.forEach(ele => {
                            serviceList += `
                            <input type="checkbox" class="hidden" name="services[]" id="${ele.id}" value="${ele.id}">
                            <label for="${ele.id}" class="cursor-pointer">
                            <div class="relative bg-[rgba(0,0,0,.2)] p-2 max-w-fit h-[100px] mt-5 rounded-lg flex" style="box-shadow:1px 1px 1px rgba(0,0,0,.2),inset 1px 1px 1px rgba(255,255,255,.2)">
                <div class="garage-icon border-2 w-2/4 rounded-md overflow-hidden">
                                <img src="/assets/service.png"
                                        onerror="this.src='https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSeUyb754vebKqfbxScXd11wIOQGyxRlNNQBv31JG4wC9ytLmJgMP3i__68EPQpIN3vrPk&usqp=CAU'"
                                        class="h-full w-full bg-cover" alt="garage" class="object-cover">
                </div>
                <div class="garage-info w-3/4 service-info pl-2">
                                <h3 class="font-semibold text-[14px] text-left text-white wrap-none" id="serviceName">${ele.name.length > 15 ? ele.name.substring(0, 12) + '..' : ele.name}</h3>
                                <p class=" text-xs text-left text-white">${ele.description.substring(0, 40)}..</p>
                                </div>
                                <div class="flex justify-end items-center absolute bottom-2 right-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px"
                                                viewBox="0 0 24 24">
                                                <path fill="white"
                                                        d="M17 6V4H6v2h3.5c1.302 0 2.401.838 2.815 2H6v2h6.315A2.994 2.994 0 0 1 9.5 12H6v2.414L11.586 20h2.828l-6-6H9.5a5.007 5.007 0 0 0 4.898-4H17V8h-2.602a4.933 4.933 0 0 0-.924-2z" />
                                        </svg>
                                        <p class="text-white text-md text-bold">${ele.price}</p>
                                </div>
                </div>
                </label>
                `
                        });
                    }
                    serviceList += '</div></div>'
                    document.getElementById('service-container').innerHTML = serviceList;
                },
                vehicle: async () => {
                    let types = await callAPI('/customer/vehicleType');
                    let vehicleList = `
                    <div class="h-full w-full p-3">
                        <strong class="text-white text-left">Vehicle Types</strong>
                        <hr/>
                        <div class="h-[95%] w-full overflow-scroll">
                    `;
                    if (!types.types.length) {
                        vehicleList = `
                        <div class="w-full h-[80vh] flex justify-center items-center flex-col">
        <svg class="fill-[#ef4444]" width="100px" height="100px" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M520.741 163.801a10.234 10.234 0 00-3.406-3.406c-4.827-2.946-11.129-1.421-14.075 3.406L80.258 856.874a10.236 10.236 0 00-1.499 5.335c0 5.655 4.585 10.24 10.24 10.24h846.004c1.882 0 3.728-.519 5.335-1.499 4.827-2.946 6.352-9.248 3.406-14.075L520.742 163.802zm43.703-26.674L987.446 830.2c17.678 28.964 8.528 66.774-20.436 84.452a61.445 61.445 0 01-32.008 8.996H88.998c-33.932 0-61.44-27.508-61.44-61.44a61.445 61.445 0 018.996-32.008l423.002-693.073c17.678-28.964 55.488-38.113 84.452-20.436a61.438 61.438 0 0120.436 20.436zM512 778.24c22.622 0 40.96-18.338 40.96-40.96s-18.338-40.96-40.96-40.96-40.96 18.338-40.96 40.96 18.338 40.96 40.96 40.96zm0-440.32c-22.622 0-40.96 18.338-40.96 40.96v225.28c0 22.622 18.338 40.96 40.96 40.96s40.96-18.338 40.96-40.96V378.88c0-22.622-18.338-40.96-40.96-40.96z"/></svg>
        <h2 class="text-[#ef4444] font-bold text-2xl">Oops..!!</h2><p class="text-[#ef4444]"><b> No Service available...!!!</b></p>
  </div>
                        `
                    }
                    types?.types?.forEach(type => {
                        vehicleList += `
                            <input type="radio" id="type-${type.id}" value="${type.id}"/>
                        `
                    })
                    vehicleList += "</div></div>"
                    document.getElementById('vehicle-container').innerHTML = vehicleList;
                }
            }
            let screen = ["dashboard", "vehicle", "service"];
            let nextOne = screen[screen.indexOf('<%= active%>')];
            localStorage.setItem("index", -1);

            const changePage = (step) => {
                let activeIndex = parseInt(localStorage.getItem("index"));
                localStorage.setItem("index", (activeIndex + (step == 'prev' ? -1 : 1)))
                activeIndex = parseInt(localStorage.getItem("index"));
                if (activeIndex == 0) {
                    document.getElementById('btn-prev').classList.add('hidden')
                    document.getElementById('btn-next').classList.remove('hidden')
                }
                else if (activeIndex == screen.length - 1) {
                    document.getElementById('btn-next').classList.add('hidden')
                    document.getElementById('btn-prev').classList.remove('hidden')
                }
                else {
                    document.getElementById('btn-prev').classList.remove('hidden')
                    document.getElementById('btn-next').classList.remove('hidden')
                }
                setActive(screen[activeIndex])
            }
            const setActive = (activated = "dashboard") => {
                document.querySelectorAll('.page-match-container').forEach(page => page.style.display = "none")
                if (activated != "dashboard" && !localStorage.getItem('garageId')) {
                    activated = "dashboard"
                }
                let matchScreen = document.querySelector(`#${activated}-container`);
                matchScreen.style.display = "block";
                loadData[activated]();
                history.pushState(null, null, activated == "dashboard" ? "home" : activated)
            }
            // localStorage.removeItem("index", 0);
            localStorage.removeItem('garageId');
        </script>



        <%- include('./customer/footer.ejs') %>